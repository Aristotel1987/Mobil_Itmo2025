@startuml

actor Пользователь as user
participant Модуль интерфейса as app
participant Модуль сбора данных as collector
participant Модуль управления приложением as mng
participant БазаДанныхТемператур as db
participant Модуль расчета температур as calc 
participant Датчик температуры as tsens
participant API погоды за окном as wapi

user -> app: Активация приложения
app --> user: Запрашивает логин и пароль
user -> app: Вводит логин и пароль
app -> mng: Проверка логина и пароля

alt Неправильный логин/пароль
    mng --> app: Неправильный логин или пароль
    app -> user: Сообщает об ошибке авторизации
    app -> user: Запрашивает логин и пароль снова
    user -> app: Вводит логин и пароль
    app --> mng: Проверка логина и пароля
end

alt Правильный логин/пароль
    mng --> app: Успешно
    app -> user: Сообщает, что авторизация успешна
    app --> mng: Запрашивает данные для основного экрана
    mng -> wapi: Запрашивает данные об уличной температуре
    mng -> tsens: Запрашивает данные о внутренней температуре
    mng --> calc: Запрашивает данные об ощущаемой температуре
    wapi --> mng: Передает уличную температуру
    tsens --> mng: Передает температуру в помещении
    calc --> mng: Передает данные об ощущаемой температуре
    mng --> app: Передает данные для главного экрана
    app -> user: Показывает текущие параметры микроклимата

    user -> app: Нажимает кнопку "История наблюдений"
    app -> mng: Запрос о глубине истории
    mng -> db: Запрос глубины истории
    db --> mng: Возвращает глубину истории
    mng --> app: Передает глубину истории
    app -> user: Предлагает выбрать период наблюдения
    user -> app: Вводит период наблюдения

    app --> mng: Запрос данных за указанный период
    mng --> db: Запрос данных за указанный период
    db --> mng: Передает данные по запросу
    mng --> app: Передает данные модулю интерфейса
    app -> app: Обрабатывает данные в графическом редакторе
    app --> user: Показывает график
    user -> app: Нажимает кнопку "экономия"
    app -> mng: Запрашивает расчет экономии
    mng --> calc: Запрашивает расчет экономии за выбранный период, передает данные для расчета
    calc --> mng: Передает результаты базового расчета
    mng --> app: Передает данные об экономии, предлагает дополнительные варианты расчета
    app -> user: Отображает базовую экономию, предлагает дополнительные опции
end
@enduml
